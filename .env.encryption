# Complete SaaS Encryption Configuration
# ALL ENCRYPTION FEATURES DISABLED BY DEFAULT FOR SAFETY
# Enable gradually after testing each component

# =============================================================================
# MASTER ENCRYPTION SETTINGS
# =============================================================================

# Master encryption key (base64 encoded)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
# IMPORTANT: Store securely, never commit to version control
ENCRYPTION_MASTER_KEY=

# Global encryption toggle
FIELD_ENCRYPTION_ENABLED=false

# =============================================================================
# DATABASE FIELD-LEVEL ENCRYPTION
# =============================================================================

# User data encryption (optional - names are not highly sensitive)
ENCRYPT_USER_NAMES=false
ENCRYPT_USER_EMAILS=false  # Keep false - breaks email queries
ENCRYPT_PHONE_NUMBERS=false

# Email masking for exports (safer alternative to encryption)
MASK_EMAILS_IN_EXPORTS=false

# =============================================================================
# JWT TOKEN SECURITY
# =============================================================================

# JWT Encryption (JWE) - Optional enhancement
JWT_ENCRYPTION_ENABLED=false
JWT_ENCRYPTION_KEY=  # Generate same way as master key

# JWT Security Features
JWT_FINGERPRINTING=false
JWT_IP_BINDING=false
JWT_SECURITY_LOGGING=false

# JWT Rotation
JWT_AUTO_ROTATION_ENABLED=false
JWT_ROTATION_THRESHOLD_HOURS=12
REFRESH_TOKENS_ENABLED=false
REFRESH_TOKEN_EXPIRES_IN=7d

# Standard JWT settings (existing)
JWT_SECRET=your-existing-jwt-secret
JWT_EXPIRES_IN=24h
JWT_ISSUER=task-management-system

# =============================================================================
# LOG SECURITY & REDACTION
# =============================================================================

# Log redaction (removes sensitive data from logs)
LOG_REDACTION_ENABLED=false

# Fields to redact from logs
LOG_REDACTION_FIELDS=password,token,secret,key,authorization,email,phone

# =============================================================================
# BACKUP & EXPORT ENCRYPTION
# =============================================================================

# Backup encryption
BACKUP_ENCRYPTION_ENABLED=false
BACKUP_DIRECTORY=./backups
BACKUP_COMPRESSION=false
BACKUP_CLEANUP_ENABLED=false

# Export encryption
EXPORT_ENCRYPTION_DEFAULT=false
EXPORT_DIRECTORY=./exports

# =============================================================================
# SECRETS MANAGEMENT
# =============================================================================

# JWT Secret rotation
JWT_SECRET_ROTATION=false
JWT_SECRET_NEW=  # For rotation process

# Key rotation schedule (future use)
KEY_ROTATION_ENABLED=false
KEY_ROTATION_INTERVAL_DAYS=90

# =============================================================================
# RUNTIME SECURITY
# =============================================================================

# Memory protection
SECURE_MEMORY_WIPING=false

# Encryption performance monitoring
ENCRYPTION_PERFORMANCE_MONITORING=false

# =============================================================================
# WHAT SHOULD NOT BE ENCRYPTED (IMPORTANT)
# =============================================================================

# These fields MUST remain unencrypted for functionality:
# - User email (required for login queries)
# - User ID (required for all queries)
# - Organization ID (required for data isolation)
# - Task status (required for kanban queries)
# - Roles (required for authorization)
# - Timestamps (required for sorting/filtering)
# - Password hashes (use bcrypt hashing, not encryption)

# =============================================================================
# DEPLOYMENT PHASES
# =============================================================================

# Phase 1: Deploy with all encryption disabled (current state)
# Phase 2: Enable LOG_REDACTION_ENABLED=true, test for 48h
# Phase 3: Enable BACKUP_ENCRYPTION_ENABLED=true, test backup/restore
# Phase 4: Enable EXPORT_ENCRYPTION_DEFAULT=true, test exports
# Phase 5: Consider JWT_ENCRYPTION_ENABLED=true if needed
# Phase 6: Consider field encryption for truly sensitive data only

# =============================================================================
# SECURITY RECOMMENDATIONS
# =============================================================================

# 1. ALWAYS ENCRYPTED (High Priority):
#    - Database backups (BACKUP_ENCRYPTION_ENABLED=true)
#    - Sensitive data exports (EXPORT_ENCRYPTION_DEFAULT=true)
#    - Log redaction (LOG_REDACTION_ENABLED=true)

# 2. CONDITIONALLY ENCRYPTED (Medium Priority):
#    - JWT tokens if they contain sensitive data (JWT_ENCRYPTION_ENABLED=true)
#    - Phone numbers if collected (ENCRYPT_PHONE_NUMBERS=true)

# 3. NEVER ENCRYPT (Critical for Functionality):
#    - User emails (breaks login)
#    - User IDs (breaks all queries)
#    - Organization IDs (breaks data isolation)
#    - Task status (breaks kanban)
#    - Roles (breaks authorization)

# =============================================================================
# MONITORING & ALERTS
# =============================================================================

# Monitor these after enabling encryption:
# - Query performance on encrypted fields
# - Backup/restore success rates
# - Export generation times
# - JWT verification performance
# - Memory usage patterns

# Alert conditions:
# - Encryption/decryption failures
# - Key rotation failures
# - Backup encryption failures
# - Unusual encryption performance degradation

# =============================================================================
# COMPLIANCE NOTES
# =============================================================================

# GDPR: Log redaction and export encryption help with data protection
# SOC 2: Backup encryption and audit logging support compliance
# HIPAA: Not applicable (no health data stored)
# PCI DSS: Not applicable (no payment data stored)

# =============================================================================
# EMERGENCY PROCEDURES
# =============================================================================

# If encryption causes issues:
# 1. Set FIELD_ENCRYPTION_ENABLED=false immediately
# 2. Restart application
# 3. Verify all functionality works
# 4. Check logs for encryption errors
# 5. Restore from unencrypted backup if needed

# Key recovery:
# - Master keys should be backed up securely offline
# - Consider key escrow for critical production systems
# - Document key recovery procedures